language: node_js
node_js:
  - "12"
  - "14"
  - "16"

cache:
  npm: false
  directories:
    - "~/.pnpm-store"
before_install:
  - curl -f https://get.pnpm.io/v6.16.js | node - add --global pnpm@7
  - pnpm config set store-dir ~/.pnpm-store
install:
  - pnpm install

# In your code, add this (after installing with `pnpm install --save-dev audit-ci`):
# scripts:
#   # This script should be the first that runs to reduce the risk of
#   # executing a script from a compromised PNPM package.
#   - if [ "${TRAVIS_PULL_REQUEST}" != "false" ]; then audit-ci -m; fi

script:
  # Have audit-ci run audit-ci to audit itself :)
  # Temporary to properly test TypeScript PR
  - pnpm run build
  - if [ "${TRAVIS_PULL_REQUEST}" != "false" ]; then node dist/audit-ci.js --config ./audit-ci.jsonc; fi
  - pnpm run lint
  - pnpm run test
